<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="msapplication-TileImage" content="/dist/images/favicon_144x144.png">
<title>{{ia.recommend.title}}</title>
<link rel="shortcut icon" href="/dist/images/favicon_144x144.png">
<link rel="stylesheet" href="/dist/lib/css/swiper.min.css">
<link rel="stylesheet" href="/dist/css/contents.css">
<link rel="stylesheet" href="/dist/css/recommend.css">
<script src="/dist/lib/js/jquery-3.6.0.min.js"></script>
<script src="/dist/lib/js/jquery-ui.min.js"></script>
<script src="/dist/lib/js/swiper.min.js"></script>
<script src="/dist/js/ux-common.js"></script>
</head>
<body>
<div class="wrapper">
  {{>header}}

  <div class="container">
    <div class="content">

      <div class="reco">
        <!-- kv -->
        <div class="reco_kv">
          <div class="reco_kv_inner">
            <div class="reco_kv_copy">
              <h1 class="reco_kv_title">Sony Store<br>Products</h1>
              <p class="reco_kv_desc">당신의 삶을 특별하게 해줄 스마트한 <br>소니 스토어 추천 제품을 살펴보세요.</p>
            </div>
            <div id="reco_kv_img-1" class="reco_kv_img reco_kv_img-1"><img src="/dist/images/recommend/kv1.jpg" alt="분위기 잡는 사진 1"></div>
            <div id="reco_kv_img-2" class="reco_kv_img reco_kv_img-2"><img src="/dist/images/recommend/kv2.jpg" alt="분위기 잡는 사진 2"></div>
            <div id="reco_kv_img-3" class="reco_kv_img reco_kv_img-3"><img src="/dist/images/recommend/kv3.jpg" alt="분위기 잡는 사진 3"></div>
          </div>
          <div class="trigger trigger-1"></div>
          <div class="trigger trigger-2"></div>
          <div class="trigger trigger-3"></div>
          <div class="trigger trigger-4"></div>
          <div class="trigger trigger-end"></div>
        </div>
        <!-- //kv -->

        <!-- flex -->
        <div class="reco_items">
          {{#each reco.items}}
          {{#if banner}}
          <div class="reco_banner" style="background-image: url(/dist/images/recommend/{{this.bg}});">
            <div class="reco_banner_img">
              <img src="/dist/images/recommend/{{this.img}}" alt="{{this.copy}}">
            </div>
          </div>
          {{else}}
          <div class="reco_item">
            <div class="reco_item_inner">
              <a href="#" class="reco_prod">
                <img src="/dist/images/recommend/{{this.img}}" alt="{{this.title}}" class="reco_prod_img">
              </a>
              <h2 class="reco_title">{{this.title}}</h2>
              <p class="reco_desc">{{this.desc}}</p>
              <div class="reco_hashes">
                {{#each this.hash}}
                <a href="#" class="reco_hash">#{{this}}</a>
                {{/each}}
              </div>
            </div>
          </div>
          {{/if}}
          {{/each}}
        </div>
        <!-- //flex -->

        {{>fullSliderBanner}}
      </div>

    </div>
  </div>

  {{>footer}}
</div>

<!-- scrollmagic -->
<script src="/dist/lib/js/scrollmagic/plugins/TweenMax.min.js"></script>
<script src="/dist/lib/js/scrollmagic/ScrollMagic.min.js"></script>
<script src="/dist/lib/js/scrollmagic/plugins/animation.gsap.min.js"></script>
<script src="/dist/lib/js/scrollmagic/plugins/debug.addIndicators.js"></script>
<script>
  var wh = $(window).height();
  /* s : 210809 임시 초기 움직임 스크롤 */
  $(document).ready(function(){
    iniScroll();
  });
  function iniScroll(){
    let _movingStart = $('.reco_kv .trigger-2').offset().top,
        _movingEnd = $('.reco_kv .trigger-3').offset().top;

    // 플로팅 더보기 버튼 - 풀 화면 되고 난 후 노출 되게 끔 
    $('.sidebar').css("bottom","-300px");
    // 스크롤 막기
    $('html, body').on('scroll touchmove mousewheel', function(event) {
      event.preventDefault();
      event.stopPropagation();
      return false;
    });
    $('html,body').scrollTop(0);  
    setTimeout(() => {
      $('html,body').scrollTop(0);
    }, 100);
    setTimeout(() => {
      $('.sidebar').removeClass("sidebar--visible");
      $('html,body').animate({scrollTop:_movingStart}, 2000, function(){
        $('html,body').animate({scrollTop:_movingEnd}, 1500, function(){
          $('.sidebar').removeAttr("style"); // 플로팅 더보기 버튼 
        });
        // 스크롤 막기 해제
        $('html, body').off('scroll touchmove mousewheel');
      });
      
    }, 500);
  }
  /* e : 210809 임시 초기 움직임 스크롤 */
  
  $(window).on("resize", ()=> {
    wh = $(window).height();
  });

  var controller = new ScrollMagic.Controller();

  var tween1 = TweenMax.to(".reco_kv_img-1", 1, {className: "+=end"});
  var scene1 = new ScrollMagic.Scene({triggerElement: ".trigger-1", duration: wh * 0.4})
    .setTween(tween1)
    .addIndicators({name: "img1"})
    .addTo(controller);

  var tween2 = TweenMax.to(".reco_kv_img-2", 1, {className: "+=end"});
  var scene2 = new ScrollMagic.Scene({triggerElement: ".trigger-2", duration: wh * 0.4})
    .setTween(tween2)
    .addIndicators({name: "img2"})
    .addTo(controller);

  var tween3 = TweenMax.to(".reco_kv_img-3", 1, {className: "+=end"});
  var scene3 = new ScrollMagic.Scene({triggerElement: ".trigger-3", duration: wh * 0.5})
    .setTween(tween3)
    .addIndicators({name: "img3"})
    .addTo(controller);

  var tween4 = TweenMax.to(".reco_kv_copy", 1, {delay:0.9, className: "+=end"}); /* 210809 delay 수정 */
  var scene4 = new ScrollMagic.Scene({triggerElement: ".trigger-4", duration: wh * 0.5})
    .setTween(tween4)
    .addIndicators({name: "copy"})
    .addTo(controller);

  new ScrollMagic.Scene({triggerElement: ".trigger-end"})
    .setClassToggle(".reco_kv_inner", "end")
    .addIndicators({name: "inner"})
    .addTo(controller);

  var tweenBanner = TweenMax.to(".reco_banner_img", 2, {className: "+=end"});
  var sceneBanner = new ScrollMagic.Scene({triggerElement: ".reco_banner", duration: wh * 0.5})
    .triggerHook(0.75)
    .setTween(tweenBanner)
    .addIndicators({name: "banner"})
    .addTo(controller);

  var items = document.querySelectorAll(".reco_item");
  var idx = 0;

  items.forEach(element => {
    const inner = element.querySelector(".reco_item_inner");
    const target = inner.children;

    for (let i = 0; i < target.length; i++) {
      const element = target[i];

      var itemTween = TweenMax.to(element, 1, {className: "+=end", delay: i * 4});
      // var itemScene = new ScrollMagic.Scene({triggerElement: inner, duration: inner.clientHeight, reverse: false})
      var itemScene = new ScrollMagic.Scene({triggerElement: inner, duration: wh * 0.5})
        .triggerHook(0.75)
        .setTween(itemTween)
        .addIndicators({name: "item-" + idx + "-" + i})
        .addTo(controller);
      idx++;
    }

  });

  // for (let index = 0; index < items.length; index++) {
  //   const element = $(items[index]);
  //   console.log(element)
  //   const inner = element.find(".reco_item_inner");

  //   var itemTween = TweenMax.to(element, 1, {className: "+=end"});
  //   var itemScene = new ScrollMagic.Scene({triggerElement: inner, duration: wh * 0.5})
  //     .setTween(itemTween)
  //     .addIndicators({name: "item" + index})
  //     .addTo(controller);
  // }

  // items.each(function() {
  //   const idx = "item" + $(this).index();

  //   $(this).addClass(idx);

  //   new ScrollMagic.Scene({triggerElement: ".reco_item"+idx+" .reco_inner"})
  //     .setClassToggle(".reco_item.item"+idx, "end")
  //     .addIndicators({name: "item"})
  //     .addTo(controller);
  // })
</script>
<!-- // scrollmagic -->

</body>
</html>